# Working with Razor Pages

## Examining Razor pages

Using our application from Lab9, we are going to create a view for all of our products.

1. Open the ASP.NET Core application we worked on in [Lab9](/Labs/9.<INSERT SLIDE TITLE HERE>.md>)
1. In Solution Explorer, create a new folder called "Pages"
1. In Solution Explorer, right-click on the "Pages" folder choose: Add -> "Razor Page". Create a page called "ProductList"
1. Expand _ProductList.cshtml_ and open its corresponding _.cshtml.cs_ file
1. Create a constructor for the `ProductListModel` and add `OrdersContext` as a parameter:
```cs
    private readonly OrdersContext _ordersContext;

    public ProductListModel(OrdersContext ordersContext)
    {
        _ordersContext = ordersContext;
    }
```

1. Create the property to hold our store's products:

```cs
    public IEnumerable<Product> Products { get; private set; }
```

1. On initialization of a Razor page, the framework looks for `OnGet()` or `OnGetAsync()` to set its initial state. Add the following method in `ProductListModel`:
```cs
    public async Task OnGetAsync()
    {
        Products = await _ordersContext.Products.ToListAsync().ConfigureAwait(false);
    }
```

1. In _ProductList.cshtml_, add the following code after the `@section Scripts { }` to iterate through each product and display them as a table:
```html
<table>
    <thead>
        <tr>
            <td>Id</td>
            <td>Name</td>
        </tr>
    </thead>
    @foreach (var product in Model.Products)
    {
        <tr>
            <td>@product.Id</td>
            <td>@product.Name</td>
        </tr>
    }
</table>
```

1. Start debugging and navigate to: http://localhost:8082/productlist

## Examining Tag Helpers

1. In `ProductsController.cs`, change inheritance from `ControllerBase` to `Controller`

## Look at Tag Helpers in the project template
1. Create a new ASP.NET Core project using the "Web Application" template with "Individual User Accounts" selected.

  ![image](Images/new-webapp-individual-accounts.PNG)

1. Open the view `Views/Account/Register.cshtml`
1. Look at the Tag Helpers attributes being used in this view (examples: `asp-controller`, `asp-validation-summary`) and play around with setting the attributes and exploring the IntelliSense offered for the different attribute types
    > Note: To get tag helper Intellisense in VS2017 install the [Razor Language Service](https://aka.ms/razorlangsvc) extension
1. Run the application and see the HTML output by the Tag Helpers
1. Look at the other views in `Views/Account/` folder to see how they use Tag Helpers
1. Open the file `Views/Shared/_Layout.cshtml`
1. Look at the Tag Helpers being used in the `<head>` element and at the end of the page to render CSS stylesheets and JavaScript files and compare it to the generated HTML output

## Create a custom Tag Helper
1. Create a new class in the application you created above, `public class RepeatTagHelper : TagHelper` and resolve any required namespaces
1. Add a property `public int Count { get; set; }`
1. Add an override for the `TagHelper.ProcessAsync()` method which repeats the content via the `output` parameter in a loop for `Count` iterations, e.g.:

```cs
    public override async Task ProcessAsync(TagHelperContext context, TagHelperOutput output)
    {
        for (int i = 0; i < Count; i++)
        {
            output.Content.AppendHtml(await output.GetChildContentAsync(useCachedResult: false));
        }
    }
```

1. Open the `_ViewImports.cshtml` file and add a line to register your Tag Helper: `@addTagHelper *, Lab6` (adjust `Lab6` to your project/assembly name)
1. Open `Views/Home/Index.cshtml` and use your Tag Helper, e.g.:

```html
  <repeat count="5">
      <h1>I'll be repeated!! @DateTime.UtcNow.Ticks</h1>
  </repeat>
```

1. Run the application again and ensure your Tag Helper is working
1. Note that the Tag Helper is rendering itself as a `<repeat>` tag (see it in the rendered HTML). We'll fix that now so that only the contents are rendered.
1. Open the `RepeatTagHelper` again and in the `ProcessAsync` method add a line to null out the tag name: `output.TagName = null;`
1. Run the application again and see that the outer tag is no longer rendered

## Extra if you have time
1. Experiment with decorating your `RepeatTagHelper` class with the `[HtmlTargetElement()]` attribute to change which HTML tag and/or attribute names it will attach itself to
